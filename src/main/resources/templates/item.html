<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
</head>
<body>
    <div th:replace="~{fragment/navbar :: navbarFragment(${sessionUsername})}"></div>
    <div class="container">
        <div class="columns is-ancestor">
            <div class="column">
                <div class="card is-child box">
                    <figure class="image">
                        <img src="https://bulma.io/assets/images/placeholders/1280x960.png" alt="Placeholder image">
                    </figure>
                </div>
            </div>
            <div th:object="${item}" class="column">
                <div class="card is-child box">
                    <h1 class="title" th:text="*{getTitle()}">Title</h1>
                    <h1 class="sub-title is-4" th:text="*{getMemberDTO().getUsername()}">Username</h1>
                    <h1 class="sub-title is-4" th:text="|개시일: *{#dates.format(getCreatedAt(), 'yyyy.MM.dd HH:mm')}|">Created At</h1>
                    <h1 th:if="*{getUpdatedAt()}" class="sub-title is-4" th:text="|수정일: *{#dates.format(getUpdatedAt(), 'yyyy.MM.dd HH:mm')}|">Updated At</h1>
                    <h1 class="title" th:text="|*{#numbers.formatInteger(getPrice(), 1, 'COMMA')}원|">Price</h1>
                    <h1 class="sub-title is-4" th:text="*{getDescription()}">Description</h1>
<!--                    <div>-->
<!--                        <button class="button is-primary is-outlined">판매자와 채팅</button>-->
<!--                    </div>-->
                    <div th:if="${isMyItem}">
                        <button class="button is-primary is-outlined">판매완료로 표시</button>
                        <button th:onclick="|location.href='@{/item/update(itemId=*{getItemId()})}'|" class="button is-primary is-outlined">수정</button>
                        <button data-target="delete-confirmation-modal" class="js-modal-trigger button is-danger is-outlined">삭제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="delete-confirmation-modal" class="modal">
        <div class="modal-background"></div>

        <div class="modal-content">
            <div class="box">
                <h1 class="title">정말 삭제하시겠습니까?</h1>
                <h1 class="title is-4">삭제 후에는 더이상 되돌릴 수 없습니다!</h1>
                <div class="field is-grouped">
                    <div class="control">
                        <button id="modal-delete" class="button is-danger">삭제하기</button>
                    </div>
                    <div class="control">
                        <button id="modal-close" class="button is-link">취소</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="modal-close is-large" aria-label="close"></button>
    </div>
    <script>
        const deleteButton = document.querySelector('#modal-delete');
        deleteButton.addEventListener('click', async () => {
            const itemId = new URLSearchParams(location.search).get('itemId');
            const response = await fetch(`/api/item/delete?itemId=${itemId}`, {
                method: 'DELETE'
            });
            const result = response.status;
            if (result === 200) {
                location.href = '/';
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            // Functions to open and close a modal
            function openModal($el) {
                $el.classList.add('is-active');
            }

            function closeModal($el) {
                $el.classList.remove('is-active');
            }

            function closeAllModals() {
                (document.querySelectorAll('.modal') || []).forEach(($modal) => {
                    closeModal($modal);
                });
            }

            // Add a click event on buttons to open a specific modal
            (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
                const modal = $trigger.dataset.target;
                const $target = document.getElementById(modal);

                $trigger.addEventListener('click', () => {
                    openModal($target);
                });
            });

            // Add a click event on various child elements to close the parent modal
            (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button, #modal-close') || []).forEach(($close) => {
                const $target = $close.closest('.modal');

                $close.addEventListener('click', () => {
                    closeModal($target);
                });
            });

            // Add a keyboard event to close all modals
            document.addEventListener('keydown', (event) => {
                if(event.key === "Escape") {
                    closeAllModals();
                }
            });
        });
</script>
</body>
</html>